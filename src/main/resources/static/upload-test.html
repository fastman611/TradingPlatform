<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .upload-area {
            border: 2px dashed #ccc;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            border-radius: 10px;
        }
        .preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .preview img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .result {
            background: #f5f5f5;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<h1>ğŸ–¼ï¸ å•†å“å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</h1>

<div class="upload-area" id="dropArea">
    <p>ğŸ“ æ‹–æ”¾å›¾ç‰‡åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
    <input type="file" id="fileInput" multiple accept="image/*">
    <p>æ”¯æŒæ ¼å¼ï¼šJPG, PNG, GIF | æœ€å¤§5MB/å¼ </p>
</div>

<div class="preview" id="preview"></div>

<div>
    <button onclick="uploadSingle()">ä¸Šä¼ å•å¼ å›¾ç‰‡</button>
    <button onclick="uploadMultiple()">ä¸Šä¼ å¤šå¼ å›¾ç‰‡</button>
    <button onclick="clearPreview()">æ¸…ç©ºé¢„è§ˆ</button>
</div>

<div class="result" id="result">
    ä¸Šä¼ ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
</div>

<script>
    let selectedFiles = [];

    // æ–‡ä»¶é€‰æ‹©å¤„ç†
    document.getElementById('fileInput').addEventListener('change', function(e) {
        selectedFiles = Array.from(e.target.files);
        updatePreview();
    });

    // æ‹–æ”¾å¤„ç†
    const dropArea = document.getElementById('dropArea');
    dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.style.borderColor = '#4CAF50';
    });

    dropArea.addEventListener('dragleave', () => {
        dropArea.style.borderColor = '#ccc';
    });

    dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.style.borderColor = '#ccc';
        selectedFiles = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
        updatePreview();
    });

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';

        selectedFiles.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.title = file.name + ' (' + formatFileSize(file.size) + ')';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        });

        document.getElementById('result').innerHTML =
            `å·²é€‰æ‹© ${selectedFiles.length} å¼ å›¾ç‰‡ï¼Œç‚¹å‡»ä¸Šä¼ æŒ‰é’®å¼€å§‹ä¸Šä¼ `;
    }

    // ä¸Šä¼ å•å¼ å›¾ç‰‡
    function uploadSingle() {
        if (selectedFiles.length === 0) {
            alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
            return;
        }

        const formData = new FormData();
        formData.append('file', selectedFiles[0]);

        fetch('/api/upload/single', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                showResult('å•å¼ å›¾ç‰‡ä¸Šä¼ ç»“æœï¼š', data);
            })
            .catch(err => {
                showResult('ä¸Šä¼ å¤±è´¥ï¼š', {success: false, message: err.message});
            });
    }

    // ä¸Šä¼ å¤šå¼ å›¾ç‰‡
    function uploadMultiple() {
        if (selectedFiles.length === 0) {
            alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
            return;
        }

        const formData = new FormData();
        selectedFiles.forEach(file => {
            formData.append('files', file);
        });

        fetch('/api/upload/multiple', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                showResult('å¤šå¼ å›¾ç‰‡ä¸Šä¼ ç»“æœï¼š', data);
            })
            .catch(err => {
                showResult('ä¸Šä¼ å¤±è´¥ï¼š', {success: false, message: err.message});
            });
    }

    // æ¸…ç©ºé¢„è§ˆ
    function clearPreview() {
        selectedFiles = [];
        document.getElementById('preview').innerHTML = '';
        document.getElementById('fileInput').value = '';
        document.getElementById('result').innerHTML = 'å·²æ¸…ç©ºé€‰æ‹©';
    }

    // æ˜¾ç¤ºç»“æœ
    function showResult(title, data) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `<strong>${title}</strong><br>` +
            JSON.stringify(data, null, 2);
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // ç‚¹å‡»åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
    dropArea.addEventListener('click', () => {
        document.getElementById('fileInput').click();
    });
</script>
</body>
</html>